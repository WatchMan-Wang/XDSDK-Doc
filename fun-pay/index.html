<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/XDSDK-Doc/blog/rss.xml" title="XDSDK 文档中心 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/XDSDK-Doc/blog/atom.xml" title="XDSDK 文档中心 Blog Atom Feed"><title data-react-helmet="true">支付 | XDSDK 文档中心</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="支付 | XDSDK 文档中心"><meta data-react-helmet="true" name="description" content="发起支付"><meta data-react-helmet="true" property="og:description" content="发起支付"><meta data-react-helmet="true" property="og:url" content="https://xindong.github.io/XDSDK-Doc/fun-pay"><link data-react-helmet="true" rel="shortcut icon" href="/XDSDK-Doc/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://xindong.github.io/XDSDK-Doc/fun-pay"><link rel="stylesheet" href="/XDSDK-Doc/styles.919d3e7a.css">
<link rel="stylesheet" href="/XDSDK-Doc/main.c62259f1.css">
<link rel="preload" href="/XDSDK-Doc/styles.a5854f72.js" as="script">
<link rel="preload" href="/XDSDK-Doc/runtime~main.d68e45aa.js" as="script">
<link rel="preload" href="/XDSDK-Doc/main.4c6a1faa.js" as="script">
<link rel="preload" href="/XDSDK-Doc/1.fa44405b.js" as="script">
<link rel="preload" href="/XDSDK-Doc/2.380f6179.js" as="script">
<link rel="preload" href="/XDSDK-Doc/15.5a4db1eb.js" as="script">
<link rel="preload" href="/XDSDK-Doc/935f2afb.8c703fc7.js" as="script">
<link rel="preload" href="/XDSDK-Doc/17896441.52d0b73c.js" as="script">
<link rel="preload" href="/XDSDK-Doc/5cfbacae.f3fadf67.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/XDSDK-Doc/"><img src="/XDSDK-Doc/img/logo.png" alt="XDSDK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/XDSDK-Doc/img/logo.png" alt="XDSDK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/XDSDK-Doc/">XDSDK</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xindong/XDSDK-Doc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/XDSDK-Doc/"><img src="/XDSDK-Doc/img/logo.png" alt="XDSDK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/XDSDK-Doc/img/logo.png" alt="XDSDK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/XDSDK-Doc/">XDSDK</a></li><li class="menu__list-item"><a href="https://github.com/xindong/XDSDK-Doc" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">快速开始</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/XDSDK-Doc/">Unity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/XDSDK-Doc/android">Android</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/XDSDK-Doc/ios">iOS</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">功能介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/XDSDK-Doc/fun-login">登录</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/XDSDK-Doc/fun-usercenter">用户</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/XDSDK-Doc/fun-pay">支付</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/XDSDK-Doc/fun-db">收据收集</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/XDSDK-Doc/xd-faq">常见问题</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">支付</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="发起支付"></a>发起支付<a class="hash-link" href="#发起支付" title="Direct link to heading">#</a></h2><span style="color:#f00;padding:0.2rem">不保证在任何情况下都能收到回调，请勿直接使用SDK返回的支付结果作为最终判定订单状态的依据。 为了收到支付回调，需要在应用启动后就设置好支付相关功能。</span><p>调用该接口发起支付。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* @param info 支付相关信息，注意key和value都是字符串类型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static bool Pay(Dictionary&lt;string, string&gt; info)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>其中info的字段如下。</p><table><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>Product_Name</td><td>是</td><td>商品名称，建议以游戏名称开头，方便财务对账</td></tr><tr><td>Product_Id</td><td>是</td><td>商品ID</td></tr><tr><td>Product_Price</td><td>是</td><td>商品价格（单位分）</td></tr><tr><td>Sid</td><td>是</td><td>所在服务器ID，不能有特殊字符，服务端支付回调会包含该字段</td></tr><tr><td>Role_Id</td><td>是</td><td>支付角色ID，服务端支付回调会包含该字段</td></tr><tr><td>OrderId</td><td>否</td><td>游戏侧订单号，服务端支付回调会包含该字段</td></tr><tr><td>EXT</td><td>否</td><td>额外信息，最长512个字符，服务端支付回调会包含该字段。可用于标记区分充值回调地址，如需使用该功能，请联系平台进行配置。#### 示例代码：info.Add(&quot;EXT&quot;, &quot;{\&quot;payCallbackCode\&quot;:2}&quot;);</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="恢复支付"></a>恢复支付<a class="hash-link" href="#恢复支付" title="Direct link to heading">#</a></h2><span style="color:#f00;padding:0.2rem">恢复支付逻辑，SDK 4.0.1(iOS)之后添加。</span><p>优化前：</p><p>在玩家第一笔掉单时，SDK 一直处于等待接收收据的状态，此时，
用户一直在游戏中，苹果随时可能发送收据给 SDK，一旦发送，SDK 就会通知游戏发送道具；
用户关闭游戏（杀进程或退后台），此时 SDK 不再接收苹果收据。导致即使这期间如果苹果有发送收据来，SDK 也收不到。除非玩家第二次充值，苹果会连同上一笔未完成订单一次性发送，造成玩家同时收到两笔道具的情况。</p><p>优化后：</p><p>当玩家再次打开游戏，SDK 再次向苹果请求一次收据信息。如有掉单的收据，且玩家登录成功后，则通知游戏，游戏来收到通知后来决定是否要补发道具。</p><span style="color:#f00;padding:0.2rem">游戏内购流程图：</span><span style="color:#f00;padding:0.2rem">注意: 如果有遗留未完成订单，在接收到恢复订单回调后，(若单个用户可能拥有多个账号，可以请求用户确认后）调用恢复订单接口。</span><p>说明：</p><p>在掉单的情况下，SDK只能获取订单的基本信息，如商品ID、苹果侧订单ID（非游戏生成order_id）和商品数量，不能直接对应到用户，所以无法直接兑换商品。</p><p>游戏在收到掉单回调之后，可以弹窗请用户确认是否需要恢复商品，如需要，则用回调提供的已有参数，加上其他需要的参数，如角色ID，服务器ID等，使用恢复订单接口恢复该商品。</p><span style="color:#f00;padding:0.2rem">SDK会提供测试包，供游戏使用沙盒测试（购买之后会造成掉单），游戏调用恢复接口如果成功到账则为测试成功。</span><p>游戏内弹窗示例(文案做相应修改)：</p><p>回调方法</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// 有未完成的订单回调，比如：礼包码.注意：多个未完成订单会在一个数组中一起回调。（只会在登录状态下回调）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// @param resultList 订单信息List。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// 单个未完成订单信息包含：     TransactionIdentifier ：订单标识 ，恢复购买时需要回传</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">///                                    Product_Id ：商品ID，</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">///                                        Quantity：商品数量</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public override void RestoredPayment(List&lt;Dictionary&lt;string,string&gt;&gt; resultList){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="恢复订单"></a>恢复订单<a class="hash-link" href="#恢复订单" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* @param info 支付相关信息，注意key和value都是字符串类型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static bool RestorePay(Dictionary&lt;string, string&gt; info)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>其中info的字段如下。</p><table><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>TransactionIdentifier</td><td>是</td><td>需要恢复的订单标识，SDK恢复订单回调中包含</td></tr><tr><td>Product_Name</td><td>是</td><td>商品名称，建议以游戏名称开头，方便财务对账</td></tr><tr><td>Product_Id</td><td>是</td><td>商品ID，到AppStore购买的商品</td></tr><tr><td>Product_Price</td><td>是</td><td>商品价格（单位分），对于AppStore支付，该字段没有用处，但是需要传递真实金额，有多处需要用到</td></tr><tr><td>Sid</td><td>是</td><td>所在服务器ID，不能有特殊字符，服务端支付回调会包含该字段</td></tr><tr><td>Role_Id</td><td>是</td><td>支付角色ID，服务端支付回调会包含该字段</td></tr><tr><td>OrderId</td><td>否</td><td>游戏侧订单号，服务端支付回调会包含该字段</td></tr><tr><td>EXT</td><td>否</td><td>额外信息，最长512个字符，服务端支付回调会包含该字段。可用于标记区分充值回调地址，如需使用该功能，请联系平台进行配置。#### 示例代码：[prdInfo setObject:@&quot;{\&quot;payCallbackCode\&quot;:1}&quot; forKey:@&quot;EXT&quot;];</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="支付结果"></a>支付结果<a class="hash-link" href="#支付结果" title="Direct link to heading">#</a></h2><p>调用发起支付和恢复支付接口会触发下列回调。</p><table><thead><tr><th>类别</th><th>回调方法</th></tr></thead><tbody><tr><td>支付完成</td><td>public void OnPayCompleted()</td></tr><tr><td>支付失败</td><td>public void OnPayFailed(string msg)</td></tr><tr><td>支付取消</td><td>public void OnPayCanceled()</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="65示例代码"></a>6.5示例代码<a class="hash-link" href="#65示例代码" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Dictionary&lt;string, string&gt; info = new Dictionary&lt;string,string&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;OrderId&quot;, &quot;1234567890123456789012345678901234567890&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;Product_Price&quot;, &quot;1&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;EXT&quot;, &quot;abcd|efgh|1234|5678&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;Sid&quot;, &quot;2&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;Role_Id&quot;, &quot;3&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;Product_Id&quot;, &quot;4&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;Product_Name&quot;, &quot;648大礼包&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info.Add(&quot;EXT&quot;, &quot;{\&quot;payCallbackCode\&quot;:2}&quot;);（）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">XDSDK.Pay (info);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/XDSDK-Doc/fun-usercenter"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 用户</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/XDSDK-Doc/fun-db"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">数据收集 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#发起支付" class="table-of-contents__link">发起支付</a></li><li><a href="#恢复支付" class="table-of-contents__link">恢复支付</a></li><li><a href="#恢复订单" class="table-of-contents__link">恢复订单</a></li><li><a href="#支付结果" class="table-of-contents__link">支付结果</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/XDSDK-Doc/styles.a5854f72.js"></script>
<script src="/XDSDK-Doc/runtime~main.d68e45aa.js"></script>
<script src="/XDSDK-Doc/main.4c6a1faa.js"></script>
<script src="/XDSDK-Doc/1.fa44405b.js"></script>
<script src="/XDSDK-Doc/2.380f6179.js"></script>
<script src="/XDSDK-Doc/15.5a4db1eb.js"></script>
<script src="/XDSDK-Doc/935f2afb.8c703fc7.js"></script>
<script src="/XDSDK-Doc/17896441.52d0b73c.js"></script>
<script src="/XDSDK-Doc/5cfbacae.f3fadf67.js"></script>
</body>
</html>